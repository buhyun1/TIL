<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ page import="java.sql.*"%>
<%@ page import="site.manage.ValidUser"%>
<%@ page import="jakarta.servlet.http.HttpSession"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Your order data</title>
<script type="text/javascript">
	function deleteOrder(orderID) {
		let hiddenDeleteForm = document.createElement('form');
		hiddenDeleteForm.action = 'manageFruit.jsp';
		hiddenDeleteForm.method = 'post';
		hiddenDeleteForm.innerHTML = '<input type="hidden" name="orderID" value="' + orderID + '"><br><input type="submit">';
		document.body.append(hiddenDeleteForm);
		hiddenDeleteForm.submit();
	}
</script>
</head>
<body>
	<%
	//세션 불러오기
	HttpSession session2 = request.getSession();
	ValidUser user = (ValidUser) session2.getAttribute("user");
	
	//driver 정보
	String driverName = "org.mariadb.jdbc.Driver";
	String dbName = "fruitdb";
	String driverURL = "jdbc:mariadb://localhost:3306/" + dbName;
	String username = "root";
	String password = "secret";

	//db 정보 받아들이기
	int dbid = 0;
	String dbemail = null;
	String dbpassword = null;
	String dbfull_name = null;

	int dbid2 = 0;
	String dbemail2 = null;
	String dbpassword2 = null;
	String dbfull_name2 = null;

	try {
		Class.forName(driverName);
	} catch (ClassNotFoundException e) {
		System.out.println("driver class not found!");
		System.out.println(e.getStackTrace());
	}

	//db에서 user_login 정보 받아오기
	try (Connection conn = DriverManager.getConnection(driverURL, username, password);
			Statement state = conn.createStatement();) {
		String sql = "SELECT * FROM fruit_order";
		ResultSet resultSet = state.executeQuery(sql);

		resultSet.next();// db 첫번째 user 불러오기 
		dbid = resultSet.getInt(1);
		dbemail = resultSet.getString(2);
		dbpassword = resultSet.getString(3);
		dbfull_name = resultSet.getString(4);

		resultSet.next();// db 두번째 user 불러오기
		dbid2 = resultSet.getInt(1);
		dbemail2 = resultSet.getString(2);
		dbpassword2 = resultSet.getString(3);
		dbfull_name2 = resultSet.getString(4);

		//sql 오류 확인
	} catch (SQLException e) {
		System.out.println("Invalid SQL: check SQL");
		e.printStackTrace();
	}
	
	ValidUser.isValidUser(dbid, dbemail, dbpassword);
	%>
	Anon Jane's order:
	<br>
	<br>
	<form name="basketForm" action="shopping.jsp" method="post">
		<fieldset style="width: 300px">
			<legend>Click delete to cancel your order</legend>
			<table>
				<tr>
					<td>Order ID</td>
					<td>Fruit</td>
					<td>Quantity</td>
					<td>Delete</td>
				</tr>
				<tr>
					<td style="text-align: left; width: 20em">3</td>
					<td style="text-align: left; width: 20em">Orange</td>
					<td style="text-align: left; width: 7em">1</td>
					<td><input type="button" style="width: 5em" value="delete"
						onclick="deleteOrder(3); return true;"></td>
				</tr>
				<tr>
					<td style="text-align: left; width: 20em">4</td>
					<td style="text-align: left; width: 20em">Papaya</td>
					<td style="text-align: left; width: 7em">4</td>
					<td><input type="button" style="width: 5em" value="delete"
						onclick="deleteOrder(4); return true;"></td>
				</tr>
			</table>
			<br>

			<div style="width: 270px;" align="right">
				<input type="submit" value="Continue shopping">
			</div>
		</fieldset>
	</form>
	<br>
	<p>
		<a href='requestLogout.do'>Log out</a>
	</p>

</body>
</html>

